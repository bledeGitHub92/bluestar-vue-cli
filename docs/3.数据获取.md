[官方文档](https://ssr.vuejs.org/zh/data.html)

## 概述

把数据获取 api 放到 store.js 中，通过 actions 调用再分发到 mutations 中改变 state 的状态。

在路由组件中创建自定义选项 asyncData 函数，通过调用定义在 store 中的异步数据获取 action 获取数据。

## 服务器端数据预取

调用路由匹配到的路由组件上的 asyncData 方法获取数据，然后同步到 context.state 上。

## 客户端数据预取

### 路由导航前获取

在 router 的全局 beforeResolve 守卫中，调用待导航守卫组件中的 asyncData 函数。

数据获取成功确认导航，失败页面则留在导航前的页面。

交互体验：可在导航失败后弹窗提示导航失败，被设置重新跳转到目标路由的按钮。

### 路由导航后获取

通过 mixin 给路由组件添加 beforeMount 钩子，在次钩子函数中调用 asnycData 函数。


```js
 Vue.mixin({
    beforeMount () {
      const { asyncData } = this.$options
      if (asyncData) {
        // 将获取数据操作分配给 promise
        // 以便在组件中，我们可以在数据准备就绪后
        // 通过运行 `this.dataPromise.then(...)` 来执行其他任务
        this.dataPromise = asyncData({
          store: this.$store,
          route: this.$route
        })
      }
    }
  })
```

交互体验：导航失败渲染数据获取组件，并设置重新导航按钮。

## 路由组件重用

当路由组件重用时（如： params 或 query 的更改，），也应该调用 asyncData 函数。

```js
Vue.mixin({
  beforeRouteUpdate (to, from, next) {
    const { asyncData } = this.$options
    if (asyncData) {
      asyncData({
        store: this.$store,
        route: to
      }).then(next).catch(next)
    } else {
      next()
    }
  }
})
```